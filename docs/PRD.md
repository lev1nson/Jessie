# **Jessie Email Assistant Product Requirements Document (PRD)**

### **Раздел 1: Цели и общий контекст**

#### **Цели (Goals)**

* **Реконструкция видения**: Восстановить и четко сформулировать стратегическое видение и позицию первоначального владельца почтового ящика, Джона, путем **синтеза** объективных фактов (что?), ключевых тем обсуждения (где?), динамики отношений и намерений (почему?), а также практически выполнимых задач (как?), извлеченных из его переписки.  
* **Рабочий прототип**: Создать функциональный прототип "Jessie", способный обрабатывать и анализировать весь унаследованный архив Gmail, включая входящие, исходящие письма и вложения.  
* **Сокращение времени анализа**: Кардинально сократить время на исследование истории переписки по сравнению с ручным процессом.  
* **Фундамент для будущего**: Заложить архитектурную основу для дальнейшей трансформации проекта в корпоративный продукт для управления знаниями.

#### **Общий контекст (Background Context)**

Проект инициирован необходимостью проанализировать и понять большой и сложный почтовый архив, унаследованный от ушедшего из жизни коллеги, Джона. Основная задача — не просто поиск информации, а глубокое понимание контекста, намерений и видения Джона, чтобы обеспечить преемственность и продолжение его работы. "Jessie Email Assistant" создается как интеллектуальный инструмент, способный "вести диалог" с этим архивом, отфильтровывать информационный шум и предоставлять синтезированные, аналитические ответы на сложные вопросы, которые невозможно получить с помощью стандартных средств поиска.

#### **Журнал изменений (Change Log)**

| Дата | Версия | Описание | Автор |
| :---- | :---- | :---- | :---- |
| 24.07.2025 | 1.0 | Начальная версия PRD | Джон (PM) |

### **Раздел 2: Требования**

#### **Функциональные требования (FR)**

* **FR1: Безопасная аутентификация**: Система ДОЛЖНА позволять пользователю безопасно подключать свой Google-аккаунт, используя протокол OAuth 2.0.  
* **FR2: Сбор писем**: Система ДОЛЖНА иметь доступ и обрабатывать как входящие, так и исходящие письма из подключенного аккаунта Gmail.  
* **FR3: Обработка вложений**: Система ДОЛЖНА извлекать и индексировать текстовое содержимое из распространенных типов вложений, включая .pdf и .docx.  
* **FR4: Автоматическая фильтрация**: Система ДОЛЖНА автоматически определять и исключать из индексации письма от известных маркетинговых и автоматических рассылок.  
* **FR5: Запросы на естественном языке**: Система ДОЛЖНА предоставлять чат-интерфейс, где пользователь может задавать вопросы на естественном языке.  
* **FR6: Извлечение фактов**: Система ДОЛЖНА отвечать на фактические вопросы, извлекая релевантную информацию из писем и вложений.  
* **FR7: Идентификация участников**: Система ДОЛЖНА уметь определять и выводить список всех уникальных участников переписки по заданной теме.  
* **FR8: Анализ за период**: Система ДОЛЖНА уметь обобщать информацию за определенный период времени для ответа на комплексные вопросы.  
* **FR9 (После MVP)**: **Анализ тональности**: Система ДОЛЖНА уметь анализировать тональность писем конкретного человека с течением времени.

#### **Нефункциональные требования (NFR)**

* **NFR1: Удобство использования**: Интерфейс ДОЛЖЕН быть интуитивно понятным, **работать отзывчиво, без заметных для пользователя задержек** при стандартных операциях, и соответствовать стандартной компоновке современных чат-приложений.  
* **NFR2: Безопасность**: Все данные пользователя, как при передаче, так и при хранении, ДОЛЖНЫ быть зашифрованы.  
* **NFR3: Масштабируемость**: Архитектура ДОЛЖНА быть спроектирована с расчетом на десятикратное увеличение объема данных.  
* **NFR4: Актуальность данных**: Система ДОЛЖНА периодически проверять и индексировать новые письма.

### **Раздел 3: Цели UI/UX дизайна**

#### **Общее видение UX**

Пользовательский опыт должен ощущаться как частный, глубокий разговор с доверенным ассистентом. Интерфейс должен быть минималистичным, сфокусированным на тексте, создавая спокойную среду для анализа.

#### **Ключевые парадигмы взаимодействия**

Основное взаимодействие — это модель диалогового чата.

#### **Основные экраны и виды**

1. **Экран входа**: Аутентификация через Google (OAuth).  
2. **Основной интерфейс чата**: Список чатов слева, активный диалог по центру.  
3. **Экран настроек**: Управление подключением и просмотр статуса индексации.

#### **Брендинг**

Стиль минималистичный, утилитарный (в духе OpenRouter), сдержанный и профессиональный, соответствующий памяти Джона.

#### **Целевые устройства и платформы**

Адаптивный веб\-дизайн (Web Responsive) с приоритетом для настольных компьютеров.

### **Раздел 4: Технические допущения**

* **Структура репозитория**: Monorepo.  
* **Архитектура сервисов**: Serverless (Бессерверная).  
* **Требования к тестированию**: Unit \+ Integration tests.  
* **Дополнительно**: Облачный хостинг, зависимость от LLM, использование векторной БД.

### **Раздел 5: Список эпиков**

* **Эпик 1: Фундамент и сбор данных**: Создать инфраструктуру, аутентификацию и конвейер для сбора и индексации данных.  
* **Эпик 2: Интерфейс и извлечение фактов**: Разработать UI и подключить его к бэкенду для выполнения простых запросов.  
* **Эпик 3: Продвинутый анализ и понимание контекста**: Реализовать сложный анализ (участники, история проекта).
* **Эпик 4: Интеграция и активация системы**: Интегрировать и активировать все реализованные компоненты для создания полностью функционального MVP.

### **Раздел 6: Детализация эпиков**

#### **Эпик 1: Фундамент и сбор данных**

**Расширенная цель**: Построить полностью автоматизированный backend конвейер для обработки данных. К концу эпика система будет самостоятельно подключаться к Gmail, забирать письма, фильтровать, извлекать текст и наполнять векторную базу данных.

* **История 1.1: Настройка проекта и базовая конфигурация облака**  
  * **Как** разработчик, **я хочу** настроить структуру проекта (монорепозиторий) и инициализировать основные облачные сервисы, **чтобы** у нас был фундамент для сборки и развертывания приложения.  
  * **Критерии приемки**: 1\. Создан монорепозиторий с папками-плейсхолдерами для backend и frontend. 2\. Создана базовая конфигурация для бессерверной функции. 3\. Настроен простейший CI/CD-пайплайн.  
* **История 1.2: Безопасная аутентификация с Google**  
  * **Как** пользователь, **я хочу** безопасно подключить свой Google-аккаунт, **чтобы** "Jessie" получила разрешение на доступ к моим письмам.  
  * **Критерии приемки**: 1\. Используется OAuth 2.0. 2\. Пользователь перенаправляется на экран согласия Google. 3\. Токены доступа безопасно сохраняются.  
* **История 1.3: Базовый конвейер сбора писем**  
  * **Как** разработчик, **я хочу** создать конвейер, который периодически забирает новые входящие и исходящие письма, **чтобы** у системы были сырые данные для обработки.  
  * **Критерии приемки**: 1\. Бессерверная функция запускается по расписанию. 2\. Функция использует сохраненные токены для подключения к Gmail API. 3\. Функция забирает еще не обработанные письма из папок "Входящие" и "Отправленные".  
* **История 1.4: Фильтрация и извлечение контента**  
  * **Как** система, **я хочу** отфильтровывать нерелевантные письма и извлекать из нужных писем чистый текст, **чтобы** база знаний содержала только качественные данные.  
  * **Критерии приемки**: 1\. Письма от отправителей из предопределенного списка "шумных" доменов отбрасываются. 2\. Из оставшихся писем извлекается только текстовое содержимое. 3\. Система определяет наличие поддерживаемых вложений (.pdf, .docx).  
* **История 1.5: Обработка вложений и векторизация**  
  * **Как** система, **я хочу** извлекать текст из вложений, объединять его с текстом письма и сохранять в виде векторов, **чтобы** весь контент был доступен для семантического поиска.  
  * **Критерии приемки**: 1\. Текст успешно извлекается из вложений .pdf и .docx. 2\. Извлеченный текст и текст письма объединяются. 3\. Объединенный текст преобразуется в векторы и сохраняется в векторной базе данных.

#### **Эпик 2: Интерфейс и извлечение фактов**

**Расширенная цель**: Этот эпик фокусируется на воплощении "Джесси" в жизнь. Мы создадим веб\-приложение, и пользователь сможет провести свой первый диалог с "Джесси", задавая простые фактические вопросы и получая релевантные ответы.

* **История 2.1: Базовая настройка Frontend-приложения**  
  * **Как** разработчик, **я хочу** настроить структуру frontend-приложения в монорепозитории, **чтобы** у нас была основа для создания пользовательского интерфейса.  
  * **Критерии приемки**: 1\. В папке frontend монорепозитория создано новое веб\-приложение. 2\. Установлены базовые зависимости для UI. 3\. Приложение можно запустить локально.  
* **История 2.2: Реализация макета интерфейса чата**  
  * **Как** пользователь, **я хочу** видеть знакомый интерфейс чата со списком моих прошлых бесед слева и текущим диалогом справа, **чтобы** я мог легко ориентироваться в своих взаимодействиях.  
  * **Критерии приемки**: 1\. Главный экран разделен на две основные панели. 2\. Левая панель — это прокручиваемая область для отображения списка чатов. 3\. Правая панель содержит область для отображения сообщений и поле для ввода текста внизу.  
* **История 2.3: Подключение интерфейса к системе аутентификации**  
  * **Как** пользователь, **я хочу** войти в веб\-приложение, используя тот же аккаунт Google, который я подключил на бэкенде, **чтобы** интерфейс получил доступ к моим данным.  
  * **Критерии приемки**: 1\. В приложении есть кнопка "Войти через Google". 2\. Нажатие на кнопку инициирует процесс OAuth. 3\. После успешного входа пользователь перенаправляется на главный интерфейс чата.  
* **История 2.4: Отправка запроса и отображение ответа**  
  * **Как** пользователь, **я хочу** ввести вопрос в поле ввода, нажать Enter и увидеть как мой вопрос, так и ответ Джесси в окне диалога, **чтобы** я мог вести беседу.  
  * **Критерии приемки**: 1\. Когда пользователь отправляет текст, он появляется в истории чата как сообщение от "пользователя". 2\. Отправленный текст передается на новую API-точку на бэкенде. 3\. Бэкенд выполняет простой векторный поиск по запросу и возвращает наиболее релевантный фрагмент текста. 4\. Возвращенный текст появляется в истории чата как сообщение от "Джесси".

#### **Эпик 3: Продвинутый анализ и понимание контекста**

**Расширенная цель**: Этот эпик реализует "магию" приложения, превращая его из простого поисковика в настоящего аналитического ассистента, способного выполнить главную задачу MVP.

* **История 3.1: Реализация идентификации участников**  
  * **Как** пользователь, **я хочу** спросить "Джесси", кто был вовлечен в обсуждение определенной темы, **чтобы** я мог получить полный список всех участников разговора.  
  * **Критерии приемки**: 1\. На бэкенде создана новая API-точка для обработки запросов на идентификацию участников. 2\. При получении запроса система сначала находит все релевантные письма по этой теме. 3\. Система извлекает данные из полей To:, From:, и Cc: из всех найденных писем. 4\. Пользователю возвращается единый список уникальных участников без дубликатов.  
* **История 3.2: Улучшение обработчика запросов для анализа по времени**  
  * **Как** разработчик, **я хочу** улучшить backend-обработчик запросов, чтобы он понимал временные диапазоны и мог обобщать информацию в хронологическом порядке, **чтобы** он мог отвечать на вопросы о развитии событий во времени.  
  * **Критерии приемки**: 1\. Логика обработки запросов обновлена и теперь распознает фильтры по датам. 2\. Векторный поиск можно ограничить документами в пределах определенного диапазона дат. 3\. Система может извлекать серию релевантных документов и сортировать их по дате. 4\. Для LLM-модели разработан специальный промпт, который инструктирует ее создать обобщение на основе хронологической последовательности документов.  
* **История 3.3: Выполнение ключевого аналитического запроса**  
  * **Как** пользователь, **я хочу** спросить "Джесси", как продвигался проект за последние 5 лет, **чтобы** я мог получить сводный отчет о его истории и ключевых этапах.  
  * **Критерии приемки**: 1\. Пользователь может задать комплексный вопрос. 2\. Система извлекает необходимую информацию в хронологическом порядке. 3\. LLM-модель генерирует связный, состоящий из нескольких абзацев, текст, подробно описывающий историю проекта. 4\. Сгенерированный отчет отображается в интерфейсе чата.

#### **Эпик 4: Интеграция и активация системы**

**Расширенная цель**: Интегрировать и активировать все реализованные компоненты для создания полностью функционального MVP. К концу эпика пользователь сможет войти в систему, автоматически синхронизировать свои письма, задавать вопросы через chat interface и получать интеллектуальные ответы на основе семантического поиска.

* **История 4.1: Активация backend pipeline**  
  * **Как** system administrator, **я хочу** активировать автоматический сбор и обработку писем, **чтобы** система начала наполняться данными без ручного вмешательства.  
  * **Критерии приемки**: 1\. Cron job запускается каждый час. 2\. Environment variables настроены для production. 3\. Gmail API credentials сконфигурированы корректно. 4\. Email sync логи показывают успешное выполнение. 5\. Database содержит новые письма после первого запуска.  
* **История 4.2: Интеграция векторизации с email pipeline**  
  * **Как** система, **я хочу** автоматически векторизировать каждое новое письмо после его сбора, **чтобы** все письма становятся доступными для семантического поиска.  
  * **Критерии приемки**: 1\. Email sync pipeline автоматически запускает векторизацию. 2\. Векторизация включает текст из email body и вложений. 3\. Vectors сохраняются в pgvector с правильными embedding dimensions. 4\. Failed vectorization не блокирует email sync process. 5\. Vectorization cache используется для оптимизации.  
* **История 4.3: Подключение chat API к vector search**  
  * **Как** пользователь, **я хочу** получать реальные ответы на основе моих писем через chat interface, **чтобы** я мог анализировать свой email архив через разговор с Jessie.  
  * **Критерии приемки**: 1\. Chat API использует real vector search вместо mock data. 2\. Search results основаны на user's emails с proper data isolation. 3\. LLM responses генерируются на основе найденных email content. 4\. Chat interface показывает source emails для каждого ответа. 5\. Performance: ответы генерируются в течение 3 секунд.  
* **История 4.4: Environment setup и deployment configuration**  
  * **Как** developer, **я хочу** настроить все необходимые переменные окружения и deployment конфигурацию, **чтобы** система могла работать в production environment.  
  * **Критерии приемки**: 1\. Все environment variables настроены в Vercel для production. 2\. Local development environment работает с корректными переменными. 3\. Database migrations выполнены в production Supabase. 4\. Google Cloud Project настроен для Gmail API access. 5\. OpenAI API account настроен с appropriate limits.  
* **История 4.5: Мониторинг и health checks**  
  * **Как** system administrator, **я хочу** видеть статус всех компонентов системы, **чтобы** я мог отслеживать работоспособность и устранять проблемы.  
  * **Критерии приемки**: 1\. Health check endpoints созданы для всех critical services. 2\. System status dashboard показывает real-time статус компонентов. 3\. Automated alerts настроены для critical failures. 4\. Performance metrics собираются и отображаются. 5\. User-facing status page показывает system availability.
